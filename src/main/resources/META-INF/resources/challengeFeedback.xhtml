<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:p="http://primefaces.org/ui"
    xmlns:c="improve.persapiens.org"
    xmlns:d="http://xmlns.jcp.org/jsf/composite/improve"
    template="/layout/template.xhtml">
    <ui:define name="content" >
        <c:crud titleText="Challenges on DevOps Education" 
                titleIcon="#{resource['images/warning-orange.png']}" 
                titleStyleClass="challenge" 
                managedBean="#{challengeFeedbackCrudMBean}" 
                showInsert="false" 
                showUpdateActionLink="false">
            <ui:define name="listColumns">
                <c:searchHeader searchValidator="#{challengeSearchValidator}" />
                
                <c:columnMainIdea field="challenge.mainIdea" />

                <c:columnTheme field="challenge.theme" 
                               value="#{bean.challenge.theme.value}"
                               sortable="true" 
                               filterable="true"/>

                <c:columnWillMitigate field="willMitigate"
                                      dataTableId="dataTable"
                                      feedbackCrudMBean="#{challengeFeedbackCrudMBean}" 
                                      challengeFeedback="#{bean}"
                                      commandButtonUpdate="datatable" />

            </ui:define>

            <ui:define name="detail">
                <d:challengeDetail crudMBean="#{challengeFeedbackCrudMBean}" />

                <h:panelGrid columns="2" cellpadding="3">
                    <c:label label="Deal with" />
                    <p:selectOneButton id="willMitigateSelectOneButton" value="#{challengeFeedbackCrudMBean.bean.willMitigate}" >
                        <f:selectItems value="#{booleanOptions.list}" var="entry" itemValue="#{entry}" itemLabel="#{booleanOptions.label(entry)}"/>
                        <p:ajax listener="#{challengeFeedbackCrudMBean.saveChallengeFeedback(challengeFeedbackCrudMBean.bean)}" update="willMitigateComment"/>
                    </p:selectOneButton>
                    <p:tooltip for="willMitigateSelectOneButton" value="Inform if the you want to mitigate the challenge"/>
                </h:panelGrid>

                <h:panelGrid columns="2" cellpadding="3">
                    <c:label label="Deal with Comment" />
                    <p:inputTextarea id="willMitigateComment" value="#{challengeFeedbackCrudMBean.bean.willMitigateComment}"
                                     placeholder="Comment how you deal with this challenge. It is optional."
                                     rows="4" cols="80"
                                     disabled="#{challengeFeedbackCrudMBean.bean.willMitigate eq null}">
                        <p:ajax listener="#{challengeFeedbackCrudMBean.saveChallengeFeedback(challengeFeedbackCrudMBean.bean)}" />
                    </p:inputTextarea>
                </h:panelGrid>

                <p:accordionPanel multiple="true" activeIndex="0" id="recommendationFeedbackAccordionPanel">
                    <p:tab title="Recommendation Links (#{challengeFeedbackCrudMBean.linkRecommendationFeedbackList.size()})"
                           titleStyleClass="recommendation" 
                           titletip="Show / hide the list of linked recommendations">
                        <p:dataTable id="linkDatatable"
                                     widgetVar="linkDatatable"
                                     value="#{challengeFeedbackCrudMBean.linkRecommendationFeedbackList}"
                                     var="linkRecommendationFeedback"
                                     emptyMessage="Sem Registros"
                                     rows="#{challengeFeedbackCrudMBean.linkRecommendationFeedbackList.size() gt 7 ? 7 : challengeFeedbackCrudMBean.linkRecommendationFeedbackList.size()}"
                                     paginator="#{challengeFeedbackCrudMBean.linkRecommendationFeedbackList.size() gt 7}"
                                     rowsPerPageTemplate="7,10,20,50"
                                     paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} {CurrentPageReport}"
                                     stripedRows="true"
                                     rowIndexVar="rowIdx"
                                     >
                            <c:columnMainIdea field="link.recommendation.mainIdea" />
                            
                            <c:columnTheme field="link.recommendation.theme" 
                                           value="#{linkRecommendationFeedback.link.recommendation.theme.value}"
                                           sortable="true" 
                                           filterable="false"/>

                            <c:columnUsedAlready field="recommendationFeedback.usedAlready"
                                                 dataTableId='linkDatatable' 
                                                 feedbackCrudMBean="#{challengeFeedbackCrudMBean}" 
                                                 recommendationFeedback="#{linkRecommendationFeedback.recommendationFeedback}"
                                                 commandButtonUpdate="recommendationFeedbackAccordionPanel:linkDatatable" />
                            
                            <c:columnWillUse field="recommendationFeedback.willUse"
                                             dataTableId='linkDatatable'
                                             feedbackCrudMBean="#{challengeFeedbackCrudMBean}" 
                                             recommendationFeedback="#{linkRecommendationFeedback.recommendationFeedback}"
                                             />
                            
                        </p:dataTable>
                    </p:tab>
                </p:accordionPanel>
            </ui:define>
        </c:crud>
    </ui:define>
</ui:composition>
