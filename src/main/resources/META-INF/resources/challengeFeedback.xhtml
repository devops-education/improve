<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition
    xmlns:ui="jakarta.faces.facelets"
    xmlns:f="jakarta.faces.core"
    xmlns:h="jakarta.faces.html"
    xmlns:p="http://primefaces.org/ui"
    xmlns:c="crde.persapiens.org"
    xmlns:fn="jakarta.tags.functions"
    template="/layout/template.xhtml">
    <ui:define name="content" >
        <c:crud title="Challenges on DevOps Education" managedBean="#{challengeFeedbackCrudMBean}" showInsert="false" showUpdateActionLink="false">
            <ui:define name="listColumns">
                <f:facet name="header">
                    <p:inputText id="globalFilter" onkeyup="PF('dataTable').filter()" style="width:305px"
                                 placeholder="Search main idea, abstracts, quotes, tags" />
                </f:facet>

                <p:column responsivePriority="1" headerText="Main Idea" sortBy="#{bean.challenge.mainIdea}" >
                    <h:outputText value="#{bean.challenge.mainIdea}" />
                </p:column>

                <p:column responsivePriority="3" headerText="Interviews" sortBy="#{bean.challenge.amountOfInterviews}" filterBy="#{bean.challenge.amountOfInterviews}" style="width: 110px;">
                    <h:outputText value="#{bean.challenge.amountOfInterviews}" />
                </p:column>

                <p:column responsivePriority="3" headerText="Recommendations" sortBy="#{bean.challenge.links.size()}" filterBy="#{bean.challenge.links.size()}" style="width: 170px;">
                    <h:outputText value="#{bean.challenge.links.size()}" />
                </p:column>

                <p:column responsivePriority="4" headerText="Theme" sortBy="#{bean.challenge.theme}" filterBy="#{bean.challenge.theme}" style="width: 220px;" >
                    <h:outputText value="#{bean.challenge.theme.value}" />
                </p:column>

                <p:column responsivePriority="2" 
                          headerText="Rating" 
                          sortBy="#{bean.rating}"
                          field="rating"
                          filterMatchMode="exact" 
                          style="width: 170px;" >
                    <f:facet name="filter">
                        <p:selectOneMenu onchange="PF('dataTable').filter()" >
                            <f:selectItem itemLabel="" itemValue="#{null}" noSelectionOption="true"/>
                            <f:selectItems value="#{ratingOptions.list}" var="entry" itemValue="#{entry}" itemLabel="#{entry.description}"/>
                        </p:selectOneMenu>
                    </f:facet>
                    <p:rating value="#{bean.rating}" converter="#{ratingConverter}">
                        <p:ajax event="rate" listener="#{challengeFeedbackCrudMBean.onrate(bean)}" update="messages"/>
                        <p:ajax event="cancel" listener="#{challengeFeedbackCrudMBean.oncancel(bean)}" update="messages"/>
                    </p:rating>
                </p:column>
            </ui:define>

            <ui:define name="detail">
                <h:panelGrid columns="2" cellpadding="3">
                    <c:text readonly="true" value="#{challengeFeedbackCrudMBean.bean.challenge.mainIdea}" label="Main Idea" />
                    <c:text readonly="true" value="#{challengeFeedbackCrudMBean.bean.challenge.amountOfInterviews}" label="Interviews" />
                    <c:text readonly="true" value="#{challengeFeedbackCrudMBean.bean.challenge.theme.value}" label="Theme" />
                </h:panelGrid>

                <p:fieldset legend="Abstracts" toggleable="true" toggleSpeed="100" collapsed="true">
                    <h:outputText readonly="true" value="#{fn:replace(challengeFeedbackCrudMBean.bean.challenge.abstracts, '\\n', '&lt;br/&gt;')}" escape="false" />
                </p:fieldset>

                <p:fieldset legend="Interviews Quotes" toggleable="true" toggleSpeed="100" collapsed="true">
                    <h:outputText readonly="true" value="#{fn:replace(challengeFeedbackCrudMBean.bean.challenge.interviewQuotes, '\\n', '&lt;br/&gt;')}" escape="false" />
                </p:fieldset>

                <p:fieldset legend="Tags" toggleable="true" toggleSpeed="100" collapsed="true">
                    <h:outputText readonly="true" value="#{fn:replace(challengeFeedbackCrudMBean.bean.challenge.tags, '\\n', '&lt;br/&gt;')}" escape="false" />
                </p:fieldset>


                <p:dataTable value="#{challengeFeedbackCrudMBean.bean.challenge.links}"
                             var="link"
                             emptyMessage="Sem Registros"
                             >
                    <p:column responsivePriority="1" headerText="Main Idea" sortBy="#{link.recommendation.mainIdea}" >
                        <h:outputText value="#{link.recommendation.mainIdea}" />
                    </p:column>
                    <p:column responsivePriority="3" headerText="Interviews" sortBy="#{link.recommendation.amountOfInterviews}" style="width: 110px;" >
                        <h:outputText value="#{link.recommendation.amountOfInterviews}" />
                    </p:column>
                    <p:column responsivePriority="3" headerText="Challenges" sortBy="#{link.recommendation.links.size()}" style="width: 170px;">
                        <h:outputText value="#{link.recommendation.links.size()}" />
                    </p:column>
                    <p:column responsivePriority="4" headerText="Theme" sortBy="#{link.recommendation.theme}" style="width: 220px;" >
                        <h:outputText value="#{link.recommendation.theme.value}" />
                    </p:column>
                    
                    <!--
                    <p:column responsivePriority="2" 
                              headerText="Rating" 
                              sortBy="#{link.rating}"
                              field="rating"
                              filterMatchMode="exact" 
                              style="width: 170px;" >
                        <f:facet name="filter">
                            <p:selectOneMenu onchange="PF('dataTable').filter()" >
                                <f:selectItem itemLabel="" itemValue="#{null}" noSelectionOption="true"/>
                                <f:selectItems value="#{ratingOptions.list}" var="entry" itemValue="#{entry}" itemLabel="#{entry.description}"/>
                            </p:selectOneMenu>
                        </f:facet>
                        <p:rating value="#{link.rating}" converter="#{ratingConverter}">
                            <p:ajax event="rate" listener="#{challengeFeedbackCrudMBean.onrate(link)}" update="messages"/>
                            <p:ajax event="cancel" listener="#{challengeFeedbackCrudMBean.oncancel(link)}" update="messages"/>
                        </p:rating>
                    </p:column>
                    -->
                </p:dataTable>

                <h:panelGrid columns="2" cellpadding="3">
                    <c:label label="Rating" />
                    <p:rating value="#{challengeFeedbackCrudMBean.bean.rating}" converter="#{ratingConverter}">
                        <p:ajax event="rate" listener="#{challengeFeedbackCrudMBean.onrate(challengeFeedbackCrudMBean.bean)}" update="messages"/>
                        <p:ajax event="cancel" listener="#{challengeFeedbackCrudMBean.oncancel(challengeFeedbackCrudMBean.bean)}" update="messages"/>
                    </p:rating>

                    <c:text label="Justification" value="#{challengeFeedbackCrudMBean.bean.justification}" size="50"/>
                </h:panelGrid>
            </ui:define>
        </c:crud>
    </ui:define>
</ui:composition>
