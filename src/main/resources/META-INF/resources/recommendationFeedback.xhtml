<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition
    xmlns:ui="jakarta.faces.facelets"
    xmlns:f="jakarta.faces.core"
    xmlns:h="jakarta.faces.html"
    xmlns:p="http://primefaces.org/ui"
    xmlns:c="crde.persapiens.org"
    xmlns:fn="jakarta.tags.functions"
    template="/layout/template.xhtml">
    <ui:define name="content" >
        <c:crud titleText="Recommendations on DevOps Education" titleStyleClass="recommendation" managedBean="#{recommendationFeedbackCrudMBean}" showInsert="false" showUpdateActionLink="false">
            <ui:define name="listColumns">
                <f:facet name="header">
                    <p:inputText id="globalFilter" onkeyup="PF('dataTable').filter()" style="width:305px"
                                 placeholder="Search main idea, abstracts, quotes, tags" />
                </f:facet>

                <p:column responsivePriority="1" headerText="Main Idea" field="recommendation.mainIdea" filterable="false"/>

                <p:column responsivePriority="3" headerText="Interviews" field="recommendation.amountOfInterviews" style="width: 110px;"/>

                <p:column responsivePriority="3" headerText="Challenges" field="recommendation.links.size()" style="width: 110px;" />

                <p:column responsivePriority="4" headerText="Theme" field="recommendation.theme" style="width: 125px;" filterMatchMode="exact">
                    #{bean.recommendation.theme.value}
                    <f:facet name="filter">
                        <p:selectOneMenu onchange="PF('dataTable').filter()">
                            <f:selectItem itemLabel="" itemValue="#{null}" noSelectionOption="true"/>
                            <f:selectItems value="#{themeOptions.list}" var="entry" itemValue="#{entry}" itemLabel="#{entry.value}"/>
                        </p:selectOneMenu>
                    </f:facet>
                </p:column>

                <p:column responsivePriority="2" 
                          headerText="Rating" 
                          field="rating"
                          filterMatchMode="exact" 
                          style="width: 170px;" >
                    <f:facet name="filter">
                        <p:selectOneMenu onchange="PF('dataTable').filter()" >
                            <f:selectItem itemLabel="" itemValue="#{null}" noSelectionOption="true"/>
                            <f:selectItems value="#{ratingOptions.list}" var="entry" itemValue="#{entry}" itemLabel="#{entry.description}"/>
                        </p:selectOneMenu>
                    </f:facet>
                    <p:rating value="#{bean.rating}" converter="#{ratingConverter}">
                        <p:ajax event="rate" listener="#{recommendationFeedbackCrudMBean.onrateRecommendationFeedback(bean)}" update="messages"/>
                        <p:ajax event="cancel" listener="#{recommendationFeedbackCrudMBean.oncancelRecommendationFeedback(bean)}" update="messages"/>
                    </p:rating>
                </p:column>
            </ui:define>

            <ui:define name="detail">
                <h:panelGrid columns="2" cellpadding="3">
                    <c:text readonly="true" value="#{recommendationFeedbackCrudMBean.bean.recommendation.mainIdea}" label="Main Idea" />
                    <c:text readonly="true" value="#{recommendationFeedbackCrudMBean.bean.recommendation.amountOfInterviews}" label="Interviews" />
                    <c:text readonly="true" value="#{recommendationFeedbackCrudMBean.bean.recommendation.theme.value}" label="Theme" />
                </h:panelGrid>

                <p:accordionPanel multiple="true" activeIndex="">
                    <p:tab title="Abstracts">
                        <h:outputText readonly="true" value="#{fn:replace(recommendationFeedbackCrudMBean.bean.recommendation.abstracts, '\\n', '&lt;br/&gt;')}" escape="false" />
                    </p:tab>

                    <p:tab title="Interviews Quotes">
                        <h:outputText readonly="true" value="#{fn:replace(recommendationFeedbackCrudMBean.bean.recommendation.interviewQuotes, '\\n', '&lt;br/&gt;')}" escape="false" />
                    </p:tab>

                    <p:tab title="Tags">
                        <h:outputText readonly="true" value="#{fn:replace(recommendationFeedbackCrudMBean.bean.recommendation.tags, '\\n', '&lt;br/&gt;')}" escape="false" />
                    </p:tab>
                </p:accordionPanel>

                <h:panelGrid columns="2" cellpadding="3">
                    <c:label label="Rating" />
                    <p:rating value="#{recommendationFeedbackCrudMBean.bean.rating}" converter="#{ratingConverter}" id="beanRating">
                        <p:ajax event="rate" listener="#{recommendationFeedbackCrudMBean.onrateRecommendationFeedback(recommendationFeedbackCrudMBean.bean)}" update="messages ratingJustification ratingCourseImprovementJustifrication linkChallengeFeedbackAccordionPanel"/>
                        <p:ajax event="cancel" listener="#{recommendationFeedbackCrudMBean.oncancelRecommendationFeedback(recommendationFeedbackCrudMBean.bean)}" update="messages ratingJustification ratingCourseImprovementJustifrication linkChallengeFeedbackAccordionPanel"/>
                    </p:rating>

                    <c:label label="Justification" />
                    <p:inputTextarea id="ratingJustification" value="#{recommendationFeedbackCrudMBean.bean.ratingJustification}"
                                     placeholder="Reason your rating for this recommendation. It is optional."
                                     rows="4" cols="80"
                                     disabled="#{recommendationFeedbackCrudMBean.bean.rating eq null}">
                        <p:ajax listener="#{recommendationFeedbackCrudMBean.justificationListener}" />
                    </p:inputTextarea>

                    <c:label label="Course Improvement" />
                    <p:inputTextarea id="ratingCourseImprovementJustifrication"
                                     value="#{recommendationFeedbackCrudMBean.bean.ratingCourseImprovementJustification}" 
                                     placeholder="Reason how this recommendation affect your course. Do you use or plan to use it? It is optional." 
                                     rows="4" cols="80"
                                     disabled="#{recommendationFeedbackCrudMBean.bean.rating eq null}">
                        <p:ajax listener="#{recommendationFeedbackCrudMBean.justificationListener}" />
                    </p:inputTextarea>
                </h:panelGrid>

                <p:accordionPanel multiple="true" activeIndex="0" id="linkChallengeFeedbackAccordionPanel">
                    <p:tab title="Challenge Links (#{recommendationFeedbackCrudMBean.linkChallengeFeedbackList.size()})" titleStyleClass="challenge" >
                        <p:dataTable value="#{recommendationFeedbackCrudMBean.linkChallengeFeedbackList}"
                                     var="linkChallengeFeedback"
                                     emptyMessage="Sem Registros"
                                     rows="5"
                                     paginator="true"
                                     rowsPerPageTemplate="5,10,20,50"
                                     paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} {CurrentPageReport}"
                                     paginatorPosition="bottom"
                                     stripedRows="true"
                                     >
                            <p:column responsivePriority="1" headerText="Main Idea" field="linkFeedback.link.challenge.mainIdea" sortable="true" filterable="false" />
                            <p:column responsivePriority="3" headerText="Interviews" field="linkFeedback.link.challenge.amountOfInterviews" style="width: 70px;" sortable="true" filterable="false" />
                            <p:column responsivePriority="3" headerText="Recommendations" field="linkFeedback.link.challenge.links.size()" style="width: 130px;" sortable="true" filterable="false" />
                            <p:column responsivePriority="4" headerText="Theme" field="linkFeedback.link.challenge.theme" style="width: 125px;" sortable="true" filterable="false" >
                                #{linkChallengeFeedback.linkFeedback.link.challenge.theme.value}
                            </p:column>

                            <p:column responsivePriority="2" 
                                      headerText="Challenge Rating" 
                                      field="challengeRating.rating"
                                      filterable="true"
                                      style="width: 170px;" >
                                <f:facet name="filter">
                                    <p:selectOneMenu onchange="PF('dataTable').filter()" >
                                        <f:selectItem itemLabel="" itemValue="#{null}" noSelectionOption="true"/>
                                        <f:selectItems value="#{ratingOptions.list}" var="entry" itemValue="#{entry}" itemLabel="#{entry.description}"/>
                                    </p:selectOneMenu>
                                </f:facet>
                                <p:rating value="#{linkChallengeFeedback.challengeFeedback.rating}" converter="#{ratingConverter}" disabled="#{recommendationFeedbackCrudMBean.bean.rating eq null}">
                                    <p:ajax event="rate" listener="#{recommendationFeedbackCrudMBean.onrateChallengeFeedback(linkChallengeFeedback.challengeFeedback)}" update="messages"/>
                                    <p:ajax event="cancel" listener="#{recommendationFeedbackCrudMBean.oncancelChallengeFeedback(linkChallengeFeedback.challengeFeedback)}" update="messages"/>
                                </p:rating>

                                <p:dialog header="Challenge Rating" widgetVar="challengeRatingJustification#{linkChallengeFeedback.challengeFeedback.challenge.id}" showEffect="fade" dynamic="true" >
                                    <p:panelGrid columns="2" layout="flex">
                                        <c:text readonly="true" value="#{recommendationFeedbackCrudMBean.ratedChallengeFeedback.challenge.mainIdea}" label="Main Idea" />

                                        <c:label id="challengeRatingJustification" label="Justification" />
                                        <p:inputTextarea value="#{recommendationFeedbackCrudMBean.ratedChallengeFeedback.ratingJustification}"
                                                         placeholder="Reason your rating for this challenge. It is optional."
                                                         rows="4" cols="70">
                                            <p:ajax listener="#{recommendationFeedbackCrudMBean.ratedChallengeFeedbackJustificationListener}" />
                                        </p:inputTextarea>
                                        <c:label id="challengeRatingCourseImprovementJustification" label="Course Improvement" />
                                        <p:inputTextarea value="#{recommendationFeedbackCrudMBean.ratedChallengeFeedback.ratingCourseImprovementJustification}" 
                                                         placeholder="Reason how this challenge affect your course. It is optional." 
                                                         rows="4" cols="70">
                                            <p:ajax listener="#{recommendationFeedbackCrudMBean.ratedChallengeFeedbackJustificationListener}" />
                                        </p:inputTextarea>
                                    </p:panelGrid>
                                    <f:facet name="footer">
                                        <p:commandButton type="button" value="Ok" onclick="PF('challengeRatingJustification#{linkChallengeFeedback.challengeFeedback.challenge.id}').hide()"/>
                                    </f:facet>
                                </p:dialog>
                            </p:column>

                            <p:column responsivePriority="2" 
                                      headerText="Link Rating" 
                                      field="rating"
                                      filterable="true"
                                      style="width: 170px;" >
                                <f:facet name="filter">
                                    <p:selectOneMenu onchange="PF('dataTable').filter()" >
                                        <f:selectItem itemLabel="" itemValue="#{null}" noSelectionOption="true"/>
                                        <f:selectItems value="#{ratingOptions.list}" var="entry" itemValue="#{entry}" itemLabel="#{entry.description}"/>
                                    </p:selectOneMenu>
                                </f:facet>
                                <p:rating value="#{linkChallengeFeedback.linkFeedback.rating}" converter="#{ratingConverter}" disabled="#{recommendationFeedbackCrudMBean.bean.rating eq null}">
                                    <p:ajax event="rate" listener="#{recommendationFeedbackCrudMBean.onrateLinkFeedback(linkChallengeFeedback.linkFeedback)}" update="messages"/>
                                    <p:ajax event="cancel" listener="#{recommendationFeedbackCrudMBean.oncancelLinkFeedback(linkChallengeFeedback.linkFeedback)}" update="messages"/>
                                </p:rating>

                                <p:dialog header="Link Rating" widgetVar="linkRatingJustification#{linkChallengeFeedback.linkFeedback.link.id}" showEffect="fade" dynamic="true" >
                                    <p:panelGrid columns="2" layout="flex">
                                        <c:text readonly="true" value="#{recommendationFeedbackCrudMBean.ratedLinkFeedback.link.recommendation.mainIdea}" label="Recommendation" />
                                        <c:text readonly="true" value="#{recommendationFeedbackCrudMBean.ratedLinkFeedback.link.challenge.mainIdea}" label="Challenge" />

                                        <c:label id="linkRatingJustification" label="Justification" />
                                        <p:inputTextarea value="#{recommendationFeedbackCrudMBean.ratedLinkFeedback.ratingJustification}"
                                                         placeholder="Reason your rating for this link. It is optional."
                                                         rows="4" cols="80">
                                            <p:ajax listener="#{recommendationFeedbackCrudMBean.ratedLinkFeedbackJustificationListener}" />
                                        </p:inputTextarea>
                                        <c:label id="linkRatingCourseImprovementJustification" label="Course Improvement" />
                                        <p:inputTextarea value="#{recommendationFeedbackCrudMBean.ratedLinkFeedback.ratingCourseImprovementJustification}" 
                                                         placeholder="Reason how this link affect your course. Do you use or plan to use it? It is optional." 
                                                         rows="4" cols="80">
                                            <p:ajax listener="#{recommendationFeedbackCrudMBean.ratedLinkFeedbackJustificationListener}" />
                                        </p:inputTextarea>
                                    </p:panelGrid>
                                    <f:facet name="footer">
                                        <p:commandButton type="button" value="Ok" onclick="PF('linkRatingJustification#{linkChallengeFeedback.linkFeedback.link.id}').hide()"/>
                                    </f:facet>
                                </p:dialog>
                            </p:column>
                        </p:dataTable>
                    </p:tab>
                </p:accordionPanel>
            </ui:define>
        </c:crud>
    </ui:define>
</ui:composition>
