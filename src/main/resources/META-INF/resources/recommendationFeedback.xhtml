<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition
    xmlns:ui="jakarta.faces.facelets"
    xmlns:f="jakarta.faces.core"
    xmlns:h="jakarta.faces.html"
    xmlns:p="http://primefaces.org/ui"
    xmlns:c="improve.persapiens.org"
    xmlns:d="jakarta.faces.composite/improve"
    xmlns:fn="jakarta.tags.functions"
    template="/layout/template.xhtml">
    <ui:define name="content" >
        <c:crud titleText="Recommendations on DevOps Education"
                titleStyleClass="recommendation"
                titleIcon="#{resource['images/ok.png']}"
                managedBean="#{recommendationFeedbackCrudMBean}"
                showInsert="false"
                showUpdateActionLink="false"
                >
            <ui:define name="listColumns">
                <f:facet name="header">
                    <span class="ui-input-icon-left">
                        <i class="pi pi-search" />
                        <p:inputText id="globalFilter" onkeyup="PF('dataTable').filter()" style="width:330px" 
                                     placeholder="Search main idea, abstracts, quotes, tags" >
                            <f:validator binding="#{challengeSearchValidator}" />
                            <p:ajax event="valueChange" update="searchMessage" />
                        </p:inputText>
                    </span>
                    
                    <p:spacer width="20px" />
                    <p:commandButton value="Recommendation Tags" 
                                     onclick="PF('recommendationTagDialog').show()"
                                     title="Open recommendation tags map image" />
                    <p:dialog header="Recommendation Tags" widgetVar="recommendationTagDialog" 
                              showEffect="fade" closeOnEscape="true" closable="true">
                        <p:graphicImage value="#{resource['images/improve/recommendation-tag-tag.jpg']}" 
                                        library="improve"
                                        width="600" 
                                        height="600" />
                    </p:dialog>
                    
                    <p:spacer width="20px" />
                    <p:link id="searchLink" 
                            value="Search Syntax" 
                            target="_blank" 
                            title="Open new page describing syntax for creating search queries"
                            href="https://lucene.apache.org/core/2_9_4/queryparsersyntax.html#Terms"/>

                    <p:message id="searchMessage" for="globalFilter" styleClass="ui-state-error"/>
                </f:facet>

                <p:column field="recommendation.mainIdea"
                          responsivePriority="1" 
                          filterable="false">
                    <f:facet name="header">
                        <h:outputText id="mainIdea" value="Main Idea" />
                        <p:tooltip for="mainIdea" 
                                   value="Sort by recommendation main idea (description)"
                                   position="top"/>
                    </f:facet>
                </p:column>

                <p:column field="recommendation.recommendationInterviews.size()"
                          responsivePriority="3" 
                          style="width: 110px;">
                    <f:facet name="header">
                        <h:outputText id="interviews" value="Interviews" /> 
                        <p:tooltip for="interviews" 
                                   value="Sort / Filter by the number of interviews that cited the recommendation" 
                                   position="top"/>
                    </f:facet>                    
                </p:column>

                <p:column field="recommendation.links.size()" 
                          responsivePriority="3" 
                          style="width: 110px;">
                    <f:facet name="header">
                        <h:outputText id="challenges" value="Challenges" />
                        <p:tooltip for="challenges" 
                                   value="Sort / Filter by the number of linked challenges" 
                                   position="top"/>
                    </f:facet>
                </p:column>

                <p:column field="recommendation.theme" 
                          responsivePriority="4" 
                          style="width: 125px;" 
                          filterMatchMode="exact">
                    <f:facet name="header">
                        <h:outputText id="theme" value="Theme" />
                        <p:tooltip for="theme" 
                                   value="Sort / Filter by the theme of the recommendation" 
                                   position="top"/>
                    </f:facet>
                    <f:facet name="filter">
                        <p:selectOneMenu onchange="PF('dataTable').filter()">
                            <f:selectItem itemLabel="" itemValue="#{null}" noSelectionOption="true"/>
                            <f:selectItems value="#{themeOptions.list}" var="entry" itemValue="#{entry}" itemLabel="#{entry.value}"/>
                        </p:selectOneMenu>
                    </f:facet>
                    #{bean.recommendation.theme.value}
                </p:column>

                <p:column field="usedAlready"
                          filterMatchMode="exact" 
                          style="width: 130px;"
                          responsivePriority="2" >
                    <f:facet name="header">
                        <h:outputText id="usedAlready" value="Used Already" />
                        <p:tooltip for="usedAlready" 
                                   value="Inform if you used already this recommendation" 
                                   position="top"/>
                    </f:facet>
                    <f:facet name="filter">
                        <p:selectOneMenu onchange="PF('dataTable').filter()" >
                            <f:selectItem itemLabel="" itemValue="#{null}"/>
                            <f:selectItems value="#{booleanOptions.list}" var="entry" itemValue="#{entry}" itemLabel="#{booleanOptions.label(entry)}"/>
                        </p:selectOneMenu>
                    </f:facet>
                    <p:selectOneButton value="#{bean.usedAlready}">
                        <f:selectItems value="#{booleanOptions.list}" var="entry" itemValue="#{entry}" itemLabel="#{booleanOptions.label(entry)}"/>
                        <p:ajax listener="#{recommendationFeedbackCrudMBean.saveRecommendationFeedbackUsedAlreadyDialog(bean)}"/>
                    </p:selectOneButton>

                    <p:dialog header="Recommendation" widgetVar="recommendationDialog#{bean.recommendation.id}" 
                              showEffect="fade" dynamic="true" >
                        <h:form>
                            <p:panelGrid columns="2" layout="flex">
                                <c:text readonly="true" value="#{bean.recommendation.mainIdea}" label="Main Idea" />

                                <p:outputPanel>
                                    <c:label label="Used Already" />
                                    <p:spacer width="20"/>
                                    <p:selectOneButton id="usedAlreadySelectOneButton" value="#{bean.usedAlready}">
                                        <f:selectItems value="#{booleanOptions.list}" var="entry" itemValue="#{entry}" itemLabel="#{booleanOptions.label(entry)}"/>
                                        <p:ajax listener="#{recommendationFeedbackCrudMBean.saveRecommendationFeedback(bean)}"/>
                                    </p:selectOneButton>
                                    <p:tooltip for="usedAlreadySelectOneButton" value="Inform if you used already this recommendation"/>
                                </p:outputPanel>

                                <c:label id="recommendationUsedAlreadyComment" label="Used Already Comment" />
                                <p:inputTextarea value="#{bean.usedAlreadyComment}"
                                                 placeholder="Comment your about how you used already this recommendation. It is optional."
                                                 rows="4" cols="70">
                                    <p:ajax listener="#{recommendationFeedbackCrudMBean.saveRecommendationFeedback(bean)}" />
                                </p:inputTextarea>

                                <p:outputPanel>
                                    <c:label label="Will Use" />
                                    <p:spacer width="20"/>
                                    <p:selectOneButton id="willUseSelectOneButton" value="#{bean.willUse}">
                                        <f:selectItems value="#{booleanOptions.list}" var="entry" itemValue="#{entry}" itemLabel="#{booleanOptions.label(entry)}"/>
                                        <p:ajax listener="#{recommendationFeedbackCrudMBean.saveRecommendationFeedback(bean)}"/>
                                    </p:selectOneButton>
                                    <p:tooltip for="willUseSelectOneButton" value="Inform if you want to use this recommendation"/>
                                </p:outputPanel>

                                <c:label id="recommendationWillUseComment" label="Will Use Comment" />
                                <p:inputTextarea value="#{bean.willUseComment}"
                                                 placeholder="Comment your about if you will use this recommendation. It is optional."
                                                 rows="4" cols="70">
                                    <p:ajax listener="#{recommendationFeedbackCrudMBean.saveRecommendationFeedback(bean)}" />
                                </p:inputTextarea>

                                <p:commandButton value="Ok" update="datatable"/>
                            </p:panelGrid>
                        </h:form>
                    </p:dialog>
                </p:column>

                <p:column field="willUse"
                          responsivePriority="2" 
                          filterMatchMode="exact" 
                          style="width: 120px;" >
                    <f:facet name="header">
                        <h:outputText id="willUse" value="Will Use" />
                        <p:tooltip for="willUse"
                                   value="Inform if you want to use this recommendation"
                                   position="top"/>
                    </f:facet>
                    <f:facet name="filter">
                        <p:selectOneMenu onchange="PF('dataTable').filter()" >
                            <f:selectItem itemLabel="" itemValue="#{null}"/>
                            <f:selectItems value="#{booleanOptions.list}" var="entry" itemValue="#{entry}" itemLabel="#{booleanOptions.label(entry)}"/>
                        </p:selectOneMenu>
                    </f:facet>
                    <p:selectOneButton value="#{bean.willUse}">
                        <f:selectItems value="#{booleanOptions.list}" var="entry" itemValue="#{entry}" itemLabel="#{booleanOptions.label(entry)}"/>
                        <p:ajax listener="#{recommendationFeedbackCrudMBean.saveRecommendationFeedbackWillUseDialog(bean)}"/>
                    </p:selectOneButton>
                </p:column>
            </ui:define>

            <ui:define name="detail">
                <d:recommendationDetail crudMBean="#{recommendationFeedbackCrudMBean}" />

                <h:panelGrid columns="2" cellpadding="3">
                    <c:label label="Used Already" />
                    <div>
                        <p:selectOneButton id="usedAlreadySelectOneButton" value="#{recommendationFeedbackCrudMBean.bean.usedAlready}">
                            <f:selectItems value="#{booleanOptions.list}" var="entry" itemValue="#{entry}" itemLabel="#{booleanOptions.label(entry)}"/>
                            <p:ajax listener="#{recommendationFeedbackCrudMBean.saveRecommendationFeedback(recommendationFeedbackCrudMBean.bean)}" update="usedAlreadyComment"/>
                        </p:selectOneButton>
                        <p:tooltip for="usedAlreadySelectOneButton" value="Inform if you used already this recommendation"/>
                    </div>

                    <c:label label="Used Already Comment" />
                    <p:inputTextarea id="usedAlreadyComment" value="#{recommendationFeedbackCrudMBean.bean.usedAlreadyComment}"
                                     placeholder="Comment how you used already this recommendation. It is optional."
                                     rows="4" cols="80"
                                     disabled="#{recommendationFeedbackCrudMBean.bean.usedAlready eq null}">
                        <p:ajax listener="#{recommendationFeedbackCrudMBean.saveRecommendationFeedback(recommendationFeedbackCrudMBean.bean)}" />
                    </p:inputTextarea>
                </h:panelGrid>
                <h:panelGrid columns="2" cellpadding="3">
                    <c:label label="Will Use" />
                    <div>
                        <p:selectOneButton id="willUseSelectOneButton" value="#{recommendationFeedbackCrudMBean.bean.willUse}">
                            <f:selectItems value="#{booleanOptions.list}" var="entry" itemValue="#{entry}" itemLabel="#{booleanOptions.label(entry)}"/>
                            <p:ajax listener="#{recommendationFeedbackCrudMBean.saveRecommendationFeedback(recommendationFeedbackCrudMBean.bean)}" update="willUseComment"/>
                        </p:selectOneButton>
                        <p:tooltip for="willUseSelectOneButton" value="Inform if you want to use this recommendation"/>
                    </div>
                    
                    <c:label label="Will Use Comment" />
                    <p:inputTextarea id="willUseComment" value="#{recommendationFeedbackCrudMBean.bean.willUseComment}"
                                     placeholder="Comment how you will use this recommendation. It is optional."
                                     rows="4" cols="80"
                                     disabled="#{recommendationFeedbackCrudMBean.bean.willUse eq null}">
                        <p:ajax listener="#{recommendationFeedbackCrudMBean.saveRecommendationFeedback(recommendationFeedbackCrudMBean.bean)}" />
                    </p:inputTextarea>
                </h:panelGrid>

                <p:accordionPanel multiple="true" activeIndex="0" id="linkChallengeFeedbackAccordionPanel">
                    <p:tab title="Challenge Links (#{recommendationFeedbackCrudMBean.linkChallengeFeedbackList.size()})" 
                           titleStyleClass="challenge" 
                           titletip="Show / hide the list of linked challenges">
                        <p:dataTable id="linkDatatable"
                                     widgetVar="linkDatatable"
                                     value="#{recommendationFeedbackCrudMBean.linkChallengeFeedbackList}"
                                     var="linkChallengeFeedback"
                                     emptyMessage="Sem Registros"
                                     rows="5"
                                     paginator="true"
                                     rowsPerPageTemplate="5,10,20,50"
                                     paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} {CurrentPageReport}"
                                     paginatorPosition="bottom"
                                     stripedRows="true"
                                     rowIndexVar="rowIdx"
                                     >
                            
                            <c:columnChallengeMainIdea field="link.challenge.mainIdea" />
                            
                            <c:columnChallengeInterviews field="link.challenge.challengeInterviews.size()" 
                                                         style="width: 70px;"
                                                         sortable="true"
                                                         filterable="false" />

                            <c:columnChallengeLinks field="link.challenge.links.size()"
                                                    style="width: 130px;" 
                                                    sortable="true"
                                                    filterable="false" />
                            
                            <c:columnChallengeTheme field="link.challenge.theme" 
                                                    value="#{linkChallengeFeedback.link.challenge.theme.value}"
                                                    sortable="true" 
                                                    filterable="false"/>

                            <p:column responsivePriority="2" 
                                      headerText="Will Mitigate" 
                                      field="challengeFeedback.willMitigate"
                                      filterable="true"
                                      style="width: 120px;" >
                                <f:facet name="header">
                                    <h:outputText id="willMitigate" value="Will Mitigate" />
                                    <p:tooltip for="willMitigate"
                                               value="Inform if the you want to mitigate the challenge"
                                               position="top"/>
                                </f:facet>
                                <f:facet name="filter">
                                    <p:selectOneMenu onchange="PF('linkDatatable').filter()" >
                                        <f:selectItem itemLabel="" itemValue="#{null}" noSelectionOption="true"/>
                                        <f:selectItems value="#{booleanOptions.list}" var="entry" itemValue="#{entry}" itemLabel="#{booleanOptions.label(entry)}"/>
                                    </p:selectOneMenu>
                                </f:facet>
                                <p:selectOneButton value="#{linkChallengeFeedback.challengeFeedback.willMitigate}">
                                    <f:selectItems value="#{booleanOptions.list}" var="entry" itemValue="#{entry}" itemLabel="#{booleanOptions.label(entry)}"/>
                                    <p:ajax listener="#{recommendationFeedbackCrudMBean.saveChallengeFeedbackWillMitigateDialog(linkChallengeFeedback.challengeFeedback)}"/>
                                </p:selectOneButton>

                                <p:dialog header="Challenge" widgetVar="challengeDialog#{linkChallengeFeedback.challengeFeedback.challenge.id}"
                                          showEffect="fade" dynamic="true" >
                                    <h:form>
                                        <p:panelGrid columns="2" layout="flex">
                                            <c:text readonly="true" value="#{linkChallengeFeedback.challengeFeedback.challenge.mainIdea}" label="Main Idea" />

                                            <p:outputPanel>
                                                <c:label label="Will Mitigate" />
                                                <p:spacer width="20"/>
                                                <p:selectOneButton id="willMitigateSelectOneButton" value="#{linkChallengeFeedback.challengeFeedback.willMitigate}">
                                                    <f:selectItems value="#{booleanOptions.list}" var="entry" itemValue="#{entry}" itemLabel="#{booleanOptions.label(entry)}"/>
                                                    <p:ajax listener="#{recommendationFeedbackCrudMBean.saveChallengeFeedback(linkChallengeFeedback.challengeFeedback)}"/>
                                                </p:selectOneButton>
                                                <p:tooltip for="willMitigateSelectOneButton" value="Inform if the you want to mitigate the challenge"/>
                                            </p:outputPanel>

                                            <c:label id="challengeWillMitigateComment" label="Will Mitigate Comment" />
                                            <p:inputTextarea value="#{linkChallengeFeedback.challengeFeedback.willMitigateComment}" 
                                                            placeholder="Comment how you will mitigate this challenge. It is optional." 
                                                            rows="4" cols="70">
                                                <p:ajax listener="#{recommendationFeedbackCrudMBean.saveChallengeFeedback(linkChallengeFeedback.challengeFeedback)}" />
                                            </p:inputTextarea>

                                            <p:commandButton value="Ok" update="linkChallengeFeedbackAccordionPanel:linkDatatable"/>
                                        </p:panelGrid>
                                    </h:form>
                                </p:dialog>
                            </p:column>
                        </p:dataTable>
                    </p:tab>
                </p:accordionPanel>
            </ui:define>
        </c:crud>
    </ui:define>
</ui:composition>
