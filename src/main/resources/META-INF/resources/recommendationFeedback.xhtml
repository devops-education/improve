<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:p="http://primefaces.org/ui"
    xmlns:c="improve.persapiens.org"
    xmlns:d="http://xmlns.jcp.org/jsf/composite/improve"
    xmlns:fn="http://xmlns.jcp.org/jsp/jstl/functions"
    template="/layout/template.xhtml">
    <ui:define name="content" >
        <c:crud titleText="Recommendations on DevOps Education"
                titleStyleClass="recommendation"
                titleIcon="#{resource['images/ok.png']}"
                managedBean="#{recommendationFeedbackCrudMBean}"
                showInsert="false"
                showUpdateActionLink="false"
                >
            <ui:define name="listColumns">
                <c:searchHeader searchValidator="#{recommendationSearchValidator}" />

                <c:columnMainIdea field="recommendation.mainIdea" />

                <c:columnInterviews field="recommendation.recommendationInterviews.size()"
                                    style="width: 110px;"
                                    sortable="true"
                                    filterable="true" />

                <c:columnLinks field="recommendation.links.size()"
                               style="width: 110px;"
                               sortable="true"
                               filterable="true" />

                <c:columnTheme field="recommendation.theme" 
                               value="#{bean.recommendation.theme.value}"
                               sortable="true" 
                               filterable="true"/>

                <c:columnUsedAlready field="usedAlready"
                                     datatableId='datatable'
                                     feedbackCrudMBean="#{recommendationFeedbackCrudMBean}"
                                     recommendationFeedback="#{bean}"
                                     commandButtonUpdate="datatable" />                
                            
                <c:columnWillUse field="willUse"
                                 datatableId='datatable'
                                 feedbackCrudMBean="#{recommendationFeedbackCrudMBean}" 
                                 recommendationFeedback="#{bean}"
                                 />
                
            </ui:define>

            <ui:define name="detail">
                <d:recommendationDetail crudMBean="#{recommendationFeedbackCrudMBean}" />

                <h:panelGrid columns="2" cellpadding="3">
                    <c:label label="Used Already" />
                    <div>
                        <p:selectOneButton id="usedAlreadySelectOneButton" value="#{recommendationFeedbackCrudMBean.bean.usedAlready}">
                            <f:selectItems value="#{booleanOptions.list}" var="entry" itemValue="#{entry}" itemLabel="#{booleanOptions.label(entry)}"/>
                            <p:ajax listener="#{recommendationFeedbackCrudMBean.saveRecommendationFeedback(recommendationFeedbackCrudMBean.bean)}" update="usedAlreadyComment"/>
                        </p:selectOneButton>
                        <p:tooltip for="usedAlreadySelectOneButton" value="Inform if you used already this recommendation"/>
                    </div>

                    <c:label label="Used Already Comment" />
                    <p:inputTextarea id="usedAlreadyComment" value="#{recommendationFeedbackCrudMBean.bean.usedAlreadyComment}"
                                     placeholder="Comment how you used already this recommendation. It is optional."
                                     rows="4" cols="80"
                                     disabled="#{recommendationFeedbackCrudMBean.bean.usedAlready eq null}">
                        <p:ajax listener="#{recommendationFeedbackCrudMBean.saveRecommendationFeedback(recommendationFeedbackCrudMBean.bean)}" />
                    </p:inputTextarea>
                </h:panelGrid>
                
                <h:panelGrid columns="2" cellpadding="3">
                    <c:label label="Will Use" />
                    <div>
                        <p:selectOneButton id="willUseSelectOneButton" value="#{recommendationFeedbackCrudMBean.bean.willUse}">
                            <f:selectItems value="#{booleanOptions.list}" var="entry" itemValue="#{entry}" itemLabel="#{booleanOptions.label(entry)}"/>
                            <p:ajax listener="#{recommendationFeedbackCrudMBean.saveRecommendationFeedback(recommendationFeedbackCrudMBean.bean)}" update="willUseComment"/>
                        </p:selectOneButton>
                        <p:tooltip for="willUseSelectOneButton" value="Inform if you want to use this recommendation"/>
                    </div>
                    
                    <c:label label="Will Use Comment" />
                    <p:inputTextarea id="willUseComment" value="#{recommendationFeedbackCrudMBean.bean.willUseComment}"
                                     placeholder="Comment how you will use this recommendation. It is optional."
                                     rows="4" cols="80"
                                     disabled="#{recommendationFeedbackCrudMBean.bean.willUse eq null}">
                        <p:ajax listener="#{recommendationFeedbackCrudMBean.saveRecommendationFeedback(recommendationFeedbackCrudMBean.bean)}" />
                    </p:inputTextarea>
                </h:panelGrid>

                <p:accordionPanel multiple="true" activeIndex="0" id="linkChallengeFeedbackAccordionPanel">
                    <p:tab title="Challenge Links (#{recommendationFeedbackCrudMBean.linkChallengeFeedbackList.size()})" 
                           titleStyleClass="challenge" 
                           titletip="Show / hide the list of linked challenges">
                        <p:dataTable id="linkDatatable"
                                     widgetVar="linkDatatable"
                                     value="#{recommendationFeedbackCrudMBean.linkChallengeFeedbackList}"
                                     var="linkChallengeFeedback"
                                     emptyMessage="Sem Registros"
                                     rows="5"
                                     paginator="true"
                                     rowsPerPageTemplate="5,10,20,50"
                                     paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} {CurrentPageReport}"
                                     paginatorPosition="bottom"
                                     stripedRows="true"
                                     rowIndexVar="rowIdx"
                                     >
                            
                            <c:columnMainIdea field="link.challenge.mainIdea" />
                            
                            <c:columnInterviews field="link.challenge.challengeInterviews.size()" 
                                                style="width: 70px;"
                                                sortable="true"
                                                filterable="false" />

                            <c:columnLinks field="link.challenge.links.size()"
                                           style="width: 130px;" 
                                           sortable="true"
                                           filterable="false" />
                            
                            <c:columnTheme field="link.challenge.theme" 
                                           value="#{linkChallengeFeedback.link.challenge.theme.value}"
                                           sortable="true" 
                                           filterable="false"/>

                            <c:columnWillMitigate field="challengeFeedback.willMitigate" 
                                                  datatableId='linkDatatable'
                                                  feedbackCrudMBean="#{recommendationFeedbackCrudMBean}"
                                                  challengeFeedback="#{linkChallengeFeedback.challengeFeedback}"
                                                  commandButtonUpdate="linkChallengeFeedbackAccordionPanel:linkDatatable" />
                            
                        </p:dataTable>
                    </p:tab>
                </p:accordionPanel>
            </ui:define>
        </c:crud>
    </ui:define>
</ui:composition>
